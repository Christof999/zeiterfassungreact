<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projektdetails - Lauffer Zeiterfassung</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="css/gallery.css">
    <link rel="stylesheet" href="css/time-entries.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Lauffer <span>Zeiterfassung</span></h1>
                </div>
                <nav class="admin-nav">
                    <a href="admin.html" class="active">Zurück zur Übersicht</a>
                    <a href="#" id="logout-btn">Abmelden</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="project-detail-container">
            <div class="project-header">
                <h2 id="project-title">Projektdetails werden geladen...</h2>
                <div class="project-meta">
                    <span class="project-number" id="project-number"></span>
                    <span class="status-badge" id="detail-status">-</span>
                </div>
            </div>

            <div class="project-details-grid">
                <div class="detail-card">
                    <h3>Projektinformationen</h3>
                    <div class="detail-row">
                        <div class="detail-label">Standort:</div>
                        <div class="detail-value" id="detail-location">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Startdatum:</div>
                        <div class="detail-value" id="detail-start-date">-</div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Enddatum:</div>
                        <div class="detail-value" id="detail-end-date">-</div>
                    </div>
                    <div class="detail-row description-row">
                        <div class="detail-label">Beschreibung:</div>
                        <div class="detail-value" id="detail-description">-</div>
                    </div>
                </div>
            </div>

            <div class="project-tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" data-tab="timeentries-tab">Zeiteinträge</button>
                    <button class="tab-btn" data-tab="photos-tab">Baustellenfotos</button>
                    <button class="tab-btn" data-tab="documents-tab">Dokumente</button>
                </div>
                
                <div class="tab-content">
                    <!-- Zeiteinträge Tab - explizit als sichtbar markiert -->
                    <div class="project-tab-content active" id="timeentries-tab" style="display: block !important;">
                        <div class="filter-controls">
                            <input type="date" id="time-date-filter" placeholder="Nach Datum filtern">
                            <select id="time-employee-filter">
                                <option value="all">Alle Mitarbeiter</option>
                            </select>
                            <button id="clear-time-filter" class="btn secondary-btn">Filter zurücksetzen</button>
                        </div>
                        <div class="time-entries-table-container">
                            <table class="data-table" id="time-entries-table">
                                <thead>
                                    <tr>
                                        <th>Mitarbeiter</th>
                                        <th>Datum</th>
                                        <th>Einstempelzeit</th>
                                        <th>Ausstempelzeit</th>
                                        <th>Arbeitszeit</th>
                                        <th>Notizen</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Wird per JavaScript gefüllt -->
                                    <tr>
                                        <td colspan="7" class="loading-indicator">Zeiteinträge werden geladen...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Baustellenfotos Tab -->
                    <div class="project-tab-content" id="photos-tab">
                        <div class="gallery-container">
                            <div id="site-photos-gallery" class="gallery">
                                <div class="loading-indicator">Baustellenfotos werden geladen...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dokumente Tab -->
                    <div class="project-tab-content" id="documents-tab">
                        <div class="gallery-container">
                            <div id="documents-gallery" class="gallery">
                                <div class="loading-indicator">Dokumente werden geladen...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bild-Vorschau-Modal -->
    <div id="image-preview-modal" class="modal">
        <!-- Modal-Inhalt wird dynamisch per JavaScript erzeugt -->
    </div>

    <!-- Edit-Zeiteintrag-Modal -->
    <div id="edit-entry-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Zeiteintrag bearbeiten</h3>
                <button type="button" class="close-modal-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-entry-form">
                    <input type="hidden" id="edit-entry-id">
                    
                    <div class="form-group">
                        <label for="edit-employee">Mitarbeiter:</label>
                        <input type="text" id="edit-employee" disabled>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-clock-in">Einstempelzeit:</label>
                            <input type="datetime-local" id="edit-clock-in">
                        </div>
                        
                        <div class="form-group">
                            <label for="edit-clock-out">Ausstempelzeit:</label>
                            <input type="datetime-local" id="edit-clock-out">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-notes">Notizen:</label>
                        <textarea id="edit-notes" rows="3"></textarea>
                    </div>
                    
                    <!-- Pausendetails würden hier angezeigt -->
                    <div id="edit-pauses-container">
                        <!-- Dynamisch gefüllt -->
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn primary-btn">Speichern</button>
                        <button type="button" class="btn secondary-btn cancel-btn">Abbrechen</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase SDK einbinden -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- App-spezifische Skripte -->
    <script src="js/firebase-config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/project-detail.js"></script>
    
    <!-- Notfall-Script zur Sichtbarkeit -->
    <script>
        // Dieses Script wird erst ausgeführt, nachdem alles geladen ist
        window.addEventListener('load', function() {
            // 2 Sekunden warten, bis alle asynchronen Vorgänge abgeschlossen sind
            setTimeout(function() {
                console.log('Notfall-Sichtbarkeitsfix wird angewendet...');
                
                // Alle Tab-Inhalte sichtbar machen
                document.querySelectorAll('.project-tab-content').forEach(function(tab) {
                    tab.style.display = 'block';
                    tab.style.visibility = 'visible';
                    tab.style.opacity = '1';
                    console.log('Tab sichtbar gemacht:', tab.id);
                });
                
                // Tabelle und Tabelleninhalt sichtbar machen
                const table = document.getElementById('time-entries-table');
                if (table) {
                    table.style.display = 'table';
                    table.style.visibility = 'visible';
                    table.style.opacity = '1';
                    console.log('Tabelle sichtbar gemacht');
                    
                    const tableBody = table.querySelector('tbody');
                    if (tableBody) {
                        tableBody.style.display = 'table-row-group';
                        tableBody.style.visibility = 'visible';
                        tableBody.style.opacity = '1';
                        console.log('Tabellenkörper sichtbar gemacht mit', tableBody.childNodes.length, 'Zeilen');
                    }
                }
                
                // Galerie-Container sichtbar machen
                document.querySelectorAll('.gallery').forEach(function(gallery) {
                    gallery.style.display = 'grid';
                    gallery.style.visibility = 'visible';
                    gallery.style.opacity = '1';
                    console.log('Galerie sichtbar gemacht:', gallery.id, 'mit', gallery.childNodes.length, 'Elementen');
                });
                
                console.log('Sichtbarkeitsfix abgeschlossen.');
            }, 2000);
        });
    </script>
</body>
</html>
