<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Projekte auflisten</title>
    <!-- Firebase-SDKs einbinden -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    
    <!-- Datenservice und Hilfsfunktionen -->
    <script src="firebase-config.js"></script>
    <script src="data.js"></script>
</head>
<body>
    <h1>Test: Verfügbare Projekte</h1>
    <div id="projects-list">Lade Projekte...</div>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('Starte Test...');
                console.log('Firebase verfügbar:', typeof firebase !== 'undefined');
                console.log('Firebase Firestore verfügbar:', typeof firebase.firestore !== 'undefined');
                console.log('Firebase Storage verfügbar:', typeof firebase.storage !== 'undefined');
                
                console.log('Initialisiere DataService...');
                await DataService.init();
                console.log('DataService initialisiert');
                
                console.log('Lade alle Projekte...');
                const projects = await DataService.getAllProjects();
                console.log('Projekte gefunden:', projects);
                
                const projectsList = document.getElementById('projects-list');
                
                if (projects.length === 0) {
                    projectsList.innerHTML = '<p>Keine Projekte gefunden.</p>';
                } else {
                    let html = '<h2>Verfügbare Projekte:</h2><ul>';
                    projects.forEach(project => {
                        html += `<li style="margin-bottom: 10px; padding: 10px; border: 1px solid #ccc;">
                            <strong>${project.name || 'Unbenanntes Projekt'}</strong> 
                            <br><small>ID: ${project.id}</small>
                            ${project.client ? `<br><small>Kunde: ${project.client}</small>` : ''}
                            ${project.location ? `<br><small>Standort: ${project.location}</small>` : ''}
                            <br>
                            <a href="project-simple.html?id=${project.id}" target="_blank" style="display: inline-block; margin-top: 5px; padding: 5px 10px; background-color: #5e8c2f; color: white; text-decoration: none; border-radius: 3px;">
                                Details anzeigen
                            </a>
                        </li>`;
                    });
                    html += '</ul>';
                    projectsList.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Fehler beim Laden der Projekte:', error);
                console.error('Error Stack:', error.stack);
                document.getElementById('projects-list').innerHTML = 
                    `<div style="color: red; padding: 20px; border: 1px solid red; background-color: #ffe6e6;">
                        <h3>Fehler beim Laden der Projekte:</h3>
                        <p><strong>Fehlermeldung:</strong> ${error.message}</p>
                        <p><strong>Fehlertyp:</strong> ${error.name}</p>
                        <details>
                            <summary>Technische Details</summary>
                            <pre>${error.stack}</pre>
                        </details>
                    </div>`;
            }
        });
    </script>
</body>
</html>
